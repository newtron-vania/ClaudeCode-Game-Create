# Pre-Commit Check Skill
# Validates code quality and convention compliance before commit

name: pre-commit-check
description: ì»¤ë°‹ ì „ ì½”ë“œ ê·œì¹™ ì¤€ìˆ˜ë¥¼ í™•ì¸í•©ë‹ˆë‹¤
version: 1.0.0

# Activation triggers
triggers:
  keywords:
    - "ì»¤ë°‹ ì²´í¬"
    - "pre-commit check"
    - "pre-commit"
    - "ì½”ë“œ ê²€ì‚¬"
    - "commit check"
    - "ì»¤ë°‹ ì „ ê²€ì‚¬"

# Skill workflow
workflow:
  - step: 1
    name: "ë³€ê²½ëœ íŒŒì¼ í™•ì¸"
    action: git_command
    command: "git diff --cached --name-only --diff-filter=ACM"
    filter: "*.cs"
    store_as: changed_files
    display: |
      ê²€ì‚¬í•  íŒŒì¼ ëª©ë¡:
      {changed_files}

  - step: 2
    name: "ë„¤ì´ë° ì»¨ë²¤ì…˜ ê²€ì‚¬"
    action: check_patterns
    files: changed_files
    checks:
      - name: "í´ë˜ìŠ¤ëª… PascalCase"
        pattern: '^\s*public\s+class\s+([A-Z][a-zA-Z0-9]*)'
        severity: error
        message: "í´ë˜ìŠ¤ëª…ì€ PascalCaseë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤"

      - name: "ì¸í„°í˜ì´ìŠ¤ I ì ‘ë‘ì‚¬"
        pattern: '^\s*public\s+interface\s+(I[A-Z][a-zA-Z0-9]*)'
        severity: error
        message: "ì¸í„°í˜ì´ìŠ¤ëŠ” Ië¡œ ì‹œì‘í•´ì•¼ í•©ë‹ˆë‹¤"

      - name: "Private ë³€ìˆ˜ _camelCase"
        pattern: '^\s*private\s+\w+\s+(_[a-z][a-zA-Z0-9]*)'
        severity: error
        message: "Private ë³€ìˆ˜ëŠ” _camelCaseë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤"

      - name: "Public ë³€ìˆ˜ PascalCase"
        pattern: '^\s*public\s+\w+\s+([A-Z][a-zA-Z0-9]*)\s*[;=]'
        severity: warning
        message: "Public ë³€ìˆ˜ëŠ” PascalCaseë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤ (ì†ì„± ì‚¬ìš© ê¶Œì¥)"

      - name: "ë©”ì„œë“œ PascalCase"
        pattern: '^\s*public\s+\w+\s+([A-Z][a-zA-Z0-9]*)\s*\('
        severity: error
        message: "ë©”ì„œë“œëŠ” PascalCaseë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤"

      - name: "ìƒìˆ˜ UPPER_CASE"
        pattern: '^\s*const\s+\w+\s+([A-Z][A-Z0-9_]*)'
        severity: warning
        message: "ìƒìˆ˜ëŠ” UPPER_CASEë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë©ë‹ˆë‹¤"

  - step: 3
    name: "ê¸ˆì§€ íŒ¨í„´ ê²€ì‚¬"
    action: check_forbidden
    files: changed_files
    forbidden:
      - pattern: '//\s*TODO'
        severity: error
        message: "TODO ì£¼ì„ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. êµ¬í˜„ì„ ì™„ë£Œí•˜ê±°ë‚˜ ì´ìŠˆë¥¼ ìƒì„±í•˜ì„¸ìš”."

      - pattern: 'throw\s+new\s+NotImplementedException'
        severity: error
        message: "NotImplementedExceptionì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ë©”ì„œë“œë¥¼ ì™„ì „íˆ êµ¬í˜„í•˜ì„¸ìš”."

      - pattern: '\b(Mock|Fake|Stub|Placeholder)\w*'
        severity: error
        message: "Mock/Fake/Stub/Placeholder êµ¬í˜„ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì‹¤ì œ êµ¬í˜„ì„ ì™„ë£Œí•˜ì„¸ìš”."

      - pattern: 'Console\.WriteLine'
        severity: warning
        message: "Console.WriteLine ì‚¬ìš©ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. Debug.Logë¥¼ ì‚¬ìš©í•˜ì„¸ìš”."

      - pattern: 'Debug\.Log\([^"]*"[^[]*"'
        severity: warning
        message: "Debug.Logê°€ í˜•ì‹ì„ ë”°ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. [INFO/WARNING/ERROR] ClassName::MethodName í˜•ì‹ì„ ì‚¬ìš©í•˜ì„¸ìš”."

  - step: 4
    name: "Manager ì‚¬ìš© íŒ¨í„´ ê²€ì‚¬"
    action: check_patterns
    files: changed_files
    anti_patterns:
      - pattern: 'Resources\.Load'
        severity: warning
        message: "Resources.Load ì§ì ‘ ì‚¬ìš©ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ResourceManager.Instance.LoadAsyncë¥¼ ì‚¬ìš©í•˜ì„¸ìš”."
        suggestion: |
          // âŒ ì§ì ‘ ì‚¬ìš© ê¸ˆì§€
          var prefab = Resources.Load<GameObject>("Prefabs/Enemy");

          // âœ… ResourceManager ì‚¬ìš©
          ResourceManager.Instance.LoadAsync<GameObject>("Prefabs/Enemy", (prefab) => {
              // Use prefab
          });

      - pattern: 'SceneManager\.LoadScene'
        severity: warning
        message: "SceneManager.LoadScene ì§ì ‘ ì‚¬ìš©ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. CustomSceneManager.Instance.LoadSceneì„ ì‚¬ìš©í•˜ì„¸ìš”."
        suggestion: |
          // âŒ ì§ì ‘ ì‚¬ìš© ê¸ˆì§€
          SceneManager.LoadScene("NextScene");

          // âœ… CustomSceneManager ì‚¬ìš©
          CustomSceneManager.Instance.LoadScene("NextScene");

      - pattern: 'Instantiate\s*\('
        severity: info
        message: "Instantiate ì§ì ‘ ì‚¬ìš©ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. PoolManager ì‚¬ìš©ì„ ê³ ë ¤í•˜ì„¸ìš”."
        suggestion: |
          // âš ï¸ ë¹ˆë²ˆí•œ ìƒì„±/ì‚­ì œê°€ ìˆë‹¤ë©´
          var obj = Instantiate(prefab);

          // âœ… PoolManager ì‚¬ìš© ê¶Œì¥
          ResourceManager.Instance.InstantiateAsync("Prefabs/Enemy", transform, (instance) => {
              // PoolManagerì™€ ìë™ í†µí•©ë¨
          });

  - step: 5
    name: "íŒŒì¼ êµ¬ì¡° ê²€ì‚¬"
    action: check_structure
    files: changed_files
    checks:
      - name: "íŒŒì¼ëª…ê³¼ í´ë˜ìŠ¤ëª… ì¼ì¹˜"
        rule: filename_matches_classname
        severity: error
        message: "íŒŒì¼ëª…ê³¼ í´ë˜ìŠ¤ëª…ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤"

      - name: "í•œ íŒŒì¼ì— ì—¬ëŸ¬ public í´ë˜ìŠ¤"
        rule: multiple_public_classes
        severity: warning
        message: "í•œ íŒŒì¼ì— ì—¬ëŸ¬ public í´ë˜ìŠ¤ê°€ ìˆìŠµë‹ˆë‹¤. íŒŒì¼ì„ ë¶„ë¦¬í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë©ë‹ˆë‹¤."

      - name: "Coroutine ë„¤ì´ë°"
        pattern: 'IEnumerator\s+(\w+)(?!Coroutine)'
        severity: warning
        message: "Coroutine ë©”ì„œë“œëŠ” 'MethodCoroutine' í˜•ì‹ì˜ ì´ë¦„ì„ ì‚¬ìš©í•˜ì„¸ìš”."

  - step: 6
    name: "Unity íŠ¹ì • ê²€ì‚¬"
    action: check_unity
    files: changed_files
    checks:
      - name: "SerializeField private ë³€ìˆ˜"
        pattern: '\[SerializeField\]\s*private'
        severity: info
        message: "âœ… SerializeFieldë¥¼ ì˜¬ë°”ë¥´ê²Œ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤"

      - name: "Public í•„ë“œ (ì†ì„± ê¶Œì¥)"
        pattern: '^\s*public\s+(?!class|interface|enum|struct|void|int|float|bool|string)\w+\s+\w+\s*;'
        severity: warning
        message: "Public í•„ë“œ ëŒ€ì‹  ì†ì„±(Property) ì‚¬ìš©ì„ ê¶Œì¥í•©ë‹ˆë‹¤."

      - name: "Unity ìƒëª…ì£¼ê¸° ë©”ì„œë“œ ì ‘ê·¼ ì œí•œì"
        pattern: '^\s*public\s+(Awake|Start|Update|FixedUpdate|LateUpdate|OnDestroy)\s*\('
        severity: warning
        message: "Unity ìƒëª…ì£¼ê¸° ë©”ì„œë“œëŠ” privateìœ¼ë¡œ ì„ ì–¸í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë©ë‹ˆë‹¤."

  - step: 7
    name: "ê²°ê³¼ ë¦¬í¬íŠ¸ ìƒì„±"
    action: generate_report
    format: markdown
    template: |
      # ì»¤ë°‹ ì „ ì½”ë“œ ê²€ì‚¬ ê²°ê³¼

      ## ğŸ“Š ê²€ì‚¬ ìš”ì•½
      - ê²€ì‚¬í•œ íŒŒì¼: {total_files}ê°œ
      - âŒ ì˜¤ë¥˜: {error_count}ê°œ
      - âš ï¸  ê²½ê³ : {warning_count}ê°œ
      - â„¹ï¸  ì •ë³´: {info_count}ê°œ

      ---

      ## íŒŒì¼ë³„ ìƒì„¸ ê²°ê³¼

      {per_file_results}

      ---

      ## âœ… í†µê³¼í•œ ê²€ì‚¬
      {passed_checks}

      ## âš ï¸  ê²½ê³  í•­ëª©
      {warnings_list}

      ## âŒ ì˜¤ë¥˜ í•­ëª©
      {errors_list}

      ---

      ## ğŸ’¡ ê¶Œì¥ì‚¬í•­
      {suggestions}

      ---

      ## ğŸ“ ì»¤ë°‹ ê°€ëŠ¥ ì—¬ë¶€
      {commit_status}

  - step: 8
    name: "ì»¤ë°‹ ê°€ëŠ¥ ì—¬ë¶€ íŒë‹¨"
    action: evaluate
    rules:
      - condition: "error_count == 0"
        status: "âœ… ì»¤ë°‹ ê°€ëŠ¥"
        message: "ëª¨ë“  í•„ìˆ˜ ê·œì¹™ì„ í†µê³¼í–ˆìŠµë‹ˆë‹¤. ì»¤ë°‹ì„ ì§„í–‰í•˜ì„¸ìš”."

      - condition: "error_count > 0"
        status: "âŒ ì»¤ë°‹ ë¶ˆê°€"
        message: "{error_count}ê°œì˜ ì˜¤ë¥˜ë¥¼ ìˆ˜ì •í•œ í›„ ë‹¤ì‹œ ê²€ì‚¬í•˜ì„¸ìš”."
        block_commit: true

      - condition: "warning_count > 0 && error_count == 0"
        status: "âš ï¸  ê²½ê³  ìˆìŒ"
        message: "{warning_count}ê°œì˜ ê²½ê³ ê°€ ìˆìŠµë‹ˆë‹¤. ê²€í†  í›„ ì»¤ë°‹ì„ ê²°ì •í•˜ì„¸ìš”."
        prompt_user: "ê²½ê³ ë¥¼ ë¬´ì‹œí•˜ê³  ì»¤ë°‹í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (y/n)"

  - step: 9
    name: "ê°œì„  ì œì•ˆ"
    action: suggest_improvements
    based_on: report_results
    categories:
      - naming_conventions
      - manager_usage
      - code_structure
      - unity_best_practices

# Output format
output:
  format: markdown
  color_coded: true
  include_line_numbers: true
  show_code_snippets: true
  group_by_severity: true

# Configuration
config:
  severity_levels:
    error: "í•„ìˆ˜ ìˆ˜ì • (ì»¤ë°‹ ë¶ˆê°€)"
    warning: "ê¶Œì¥ ìˆ˜ì • (ê²€í†  í•„ìš”)"
    info: "ì°¸ê³  ì‚¬í•­"

  auto_fix:
    enabled: false
    safe_fixes_only: true
    patterns:
      - "trailing_whitespace"
      - "missing_newline_at_eof"

  exclude_patterns:
    - "*.meta"
    - "*/Tests/*"
    - "*/Editor/*"
    - "*/ThirdParty/*"

  file_size_limit: 5000  # lines

# Integration
integration:
  git_hooks:
    pre_commit: true

  required_docs:
    - ".claude/UNITY_CONVENTIONS.md"
    - ".claude/COMMIT_MESSAGE_RULES.md"

# Quick reference
quick_fixes:
  naming:
    - "í´ë˜ìŠ¤: PascalCase (ì˜ˆ: PlayerController)"
    - "ì¸í„°í˜ì´ìŠ¤: IPascalCase (ì˜ˆ: IDamageable)"
    - "Private ë³€ìˆ˜: _camelCase (ì˜ˆ: _health)"
    - "Public ë³€ìˆ˜: PascalCase â†’ ì†ì„± ì‚¬ìš© ê¶Œì¥"
    - "ë©”ì„œë“œ: PascalCase (ì˜ˆ: MovePlayer)"
    - "ìƒìˆ˜: UPPER_CASE (ì˜ˆ: MAX_HEALTH)"

  managers:
    - "ë¦¬ì†ŒìŠ¤ ë¡œë”©: ResourceManager.Instance.LoadAsync"
    - "ì”¬ ì „í™˜: CustomSceneManager.Instance.LoadScene"
    - "ì˜¤ë¸Œì íŠ¸ í’€ë§: ResourceManager.Instance.InstantiateAsync (ìë™ í’€ë§)"
    - "ì˜¤ë””ì˜¤: SoundManager.Instance.PlayBGM/PlaySFX"
    - "UI: UIManager.Instance.ShowPanel"
    - "ê²Œì„ ë°ì´í„°: DataManager.Instance.GetProvider"

  logging:
    format: 'Debug.Log("[INFO] ClassName::MethodName - Message");'
    levels:
      - "[INFO] - ì¼ë°˜ ì •ë³´"
      - "[WARNING] - ê²½ê³ "
      - "[ERROR] - ì˜¤ë¥˜"

# Performance considerations
performance:
  parallel_check: true
  cache_results: true
  max_file_size: 10000  # Skip files larger than 10k lines
